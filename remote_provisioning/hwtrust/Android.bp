package {
    default_applicable_licenses: ["Android-Apache-2.0"],
}

rust_defaults {
    name: "libhwtrust_defaults",
    host_supported: true,
    srcs: ["src/lib.rs"],
    rustlibs: [
        "libanyhow",
        "libthiserror",
        "libciborium",
        "libcoset",
        "libhex",
        "libopenssl",
    ],
}

rust_library {
    name: "libhwtrust",
    defaults: ["libhwtrust_defaults"],
    crate_name: "hwtrust",
    vendor_available: true,
    apex_available: [
        "//apex_available:platform",
        "com.android.compos",
        "com.android.virt",
    ],
}

rust_test {
    name: "libhwtrust_tests",
    defaults: ["libhwtrust_defaults"],
    data: [":testdata"],
    rustlibs: [
        "libhwtrust",
    ],
}

rust_defaults {
    name: "hwtrust_defaults",
    host_supported: true,
    srcs: ["src/main.rs"],
    rustlibs: [
        "libanyhow",
        "libclap",
        "libhwtrust",
    ],
}

rust_binary {
    name: "hwtrust",
    defaults: ["hwtrust_defaults"],
}

rust_test {
    name: "hwtrust_tests",
    defaults: ["hwtrust_defaults"],
}

rust_test {
    name: "hwtrust_cli_tests",
    host_supported: true,
    srcs: ["tests/hwtrust_cli.rs"],
    data: [":testdata"],
    data_bins: ["hwtrust"],
    data_libs: ["libcrypto"],
    compile_multilib: "first",
}

filegroup(
    name = "testdata",
    srcs = ["testdata/**/*"],
)
